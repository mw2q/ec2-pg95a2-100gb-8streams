BEGIN;
BEGIN
select
	nation,
	o_year,
	sum(amount) as sum_profit
from
	(
		select
			n_name as nation,
			extract(year from o_orderdate) as o_year,
			l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity as amount
		from
			part,
			supplier,
			lineitem,
			partsupp,
			orders,
			nation
		where
			s_suppkey = l_suppkey
			and ps_suppkey = l_suppkey
			and ps_partkey = l_partkey
			and p_partkey = l_partkey
			and o_orderkey = l_orderkey
			and s_nationkey = n_nationkey
			and p_name like '%light%'
	) as profit
group by
	nation,
	o_year
order by
	nation,
	o_year desc;
          nation           | o_year |    sum_profit    
---------------------------+--------+------------------
 ALGERIA                   |   1998 | 2732851220.28063
 ALGERIA                   |   1997 | 4663631276.29625
 ALGERIA                   |   1996 | 4711337498.59721
 ALGERIA                   |   1995 | 4704262291.00724
 ALGERIA                   |   1994 | 4660404699.83447
 ALGERIA                   |   1993 | 4682846479.61271
 ALGERIA                   |   1992 | 4692675904.69489
 ARGENTINA                 |   1998 | 2710454020.77755
 ARGENTINA                 |   1997 | 4601797814.64434
 ARGENTINA                 |   1996 | 4659593111.90699
 ARGENTINA                 |   1995 | 4638240931.29819
 ARGENTINA                 |   1994 | 4656017711.81992
 ARGENTINA                 |   1993 | 4647854868.65559
 ARGENTINA                 |   1992 | 4637617108.23003
 BRAZIL                    |   1998 | 2721684703.03276
 BRAZIL                    |   1997 |  4684884051.1888
 BRAZIL                    |   1996 | 4660947879.05363
 BRAZIL                    |   1995 | 4647270657.78069
 BRAZIL                    |   1994 | 4648495140.19757
 BRAZIL                    |   1993 | 4638844647.43339
 BRAZIL                    |   1992 | 4657169347.77712
 CANADA                    |   1998 | 2752335475.20098
 CANADA                    |   1997 |  4666601521.0287
 CANADA                    |   1996 |  4695432311.4576
 CANADA                    |   1995 | 4694839694.59469
 CANADA                    |   1994 | 4678108009.75286
 CANADA                    |   1993 | 4680451083.92263
 CANADA                    |   1992 | 4706772400.70259
 CHINA                     |   1998 | 2743745638.29682
 CHINA                     |   1997 | 4655770971.64789
 CHINA                     |   1996 |  4680486758.5462
 CHINA                     |   1995 |  4667087250.9216
 CHINA                     |   1994 | 4667066217.04049
 CHINA                     |   1993 | 4651961664.86956
 CHINA                     |   1992 | 4653780313.62545
 EGYPT                     |   1998 | 2722436547.63021
 EGYPT                     |   1997 | 4665992659.37629
 EGYPT                     |   1996 |    4682381841.39
 EGYPT                     |   1995 | 4652138210.70817
 EGYPT                     |   1994 | 4647565741.16881
 EGYPT                     |   1993 | 4648068956.57765
 EGYPT                     |   1992 |  4651133839.9837
 ETHIOPIA                  |   1998 | 2731695691.06017
 ETHIOPIA                  |   1997 | 4676796283.22945
 ETHIOPIA                  |   1996 | 4700844684.01244
 ETHIOPIA                  |   1995 | 4679362224.39589
 ETHIOPIA                  |   1994 | 4673677363.05388
 ETHIOPIA                  |   1993 | 4673857584.40075
 ETHIOPIA                  |   1992 | 4681264630.77105
 FRANCE                    |   1998 | 2743560015.82457
 FRANCE                    |   1997 | 4686712742.76095
 FRANCE                    |   1996 |  4701926498.8905
 FRANCE                    |   1995 | 4685477378.92782
 FRANCE                    |   1994 | 4694108429.24839
 FRANCE                    |   1993 | 4691159139.87079
 FRANCE                    |   1992 | 4692007652.90123
 GERMANY                   |   1998 | 2746598365.08127
 GERMANY                   |   1997 | 4694792831.77388
 GERMANY                   |   1996 | 4707985176.82896
 GERMANY                   |   1995 | 4677919912.43856
 GERMANY                   |   1994 | 4682912941.32444
 GERMANY                   |   1993 |  4666080755.2074
 GERMANY                   |   1992 | 4665075987.27835
 INDIA                     |   1998 | 2749275067.21677
 INDIA                     |   1997 | 4697318366.14803
 INDIA                     |   1996 | 4697907579.10389
 INDIA                     |   1995 | 4681235501.29254
 INDIA                     |   1994 | 4676725250.48123
 INDIA                     |   1993 |  4709118924.6845
 INDIA                     |   1992 | 4718629451.96674
 INDONESIA                 |   1998 | 2734931672.96214
 INDONESIA                 |   1997 |  4641451234.8526
 INDONESIA                 |   1996 | 4651270014.67994
 INDONESIA                 |   1995 | 4631078594.08457
 INDONESIA                 |   1994 | 4646542441.83592
 INDONESIA                 |   1993 | 4657767667.09171
 INDONESIA                 |   1992 | 4604598672.57283
 IRAN                      |   1998 | 2729877457.31229
 IRAN                      |   1997 |  4653462937.4812
 IRAN                      |   1996 |  4677567707.8862
 IRAN                      |   1995 |   4654333663.296
 IRAN                      |   1994 | 4647635408.66306
 IRAN                      |   1993 | 4627737944.16822
 IRAN                      |   1992 | 4622431465.23385
 IRAQ                      |   1998 | 2724074617.14175
 IRAQ                      |   1997 | 4646843996.58735
 IRAQ                      |   1996 | 4681053954.69814
 IRAQ                      |   1995 |   4627696877.328
 IRAQ                      |   1994 | 4647328902.00096
 IRAQ                      |   1993 | 4660632894.96738
 IRAQ                      |   1992 | 4670555632.77442
 JAPAN                     |   1998 | 2705740938.68486
 JAPAN                     |   1997 | 4611974373.53788
 JAPAN                     |   1996 | 4602568764.61197
 JAPAN                     |   1995 | 4629443210.35254
 JAPAN                     |   1994 | 4629359278.21158
 JAPAN                     |   1993 |  4628218359.8436
 JAPAN                     |   1992 | 4625593743.29916
 JORDAN                    |   1998 |  2725070516.1341
 JORDAN                    |   1997 | 4645665483.93876
 JORDAN                    |   1996 | 4687385875.44681
 JORDAN                    |   1995 | 4648306493.70504
 JORDAN                    |   1994 | 4659807459.05956
 JORDAN                    |   1993 | 4669128268.89819
 JORDAN                    |   1992 |  4667245683.8806
 KENYA                     |   1998 | 2715394889.28193
 KENYA                     |   1997 |  4656437707.9093
 KENYA                     |   1996 | 4669657895.85284
 KENYA                     |   1995 | 4645017326.69132
 KENYA                     |   1994 | 4638787520.15634
 KENYA                     |   1993 | 4633412641.37354
 KENYA                     |   1992 | 4643629037.87184
 MOROCCO                   |   1998 | 2733839497.16561
 MOROCCO                   |   1997 | 4655189389.21797
 MOROCCO                   |   1996 | 4668243551.43358
 MOROCCO                   |   1995 | 4682446032.05079
 MOROCCO                   |   1994 | 4661731650.11951
 MOROCCO                   |   1993 | 4671794592.97695
 MOROCCO                   |   1992 | 4668628657.97413
 MOZAMBIQUE                |   1998 | 2736798909.19516
 MOZAMBIQUE                |   1997 | 4666637191.13737
 MOZAMBIQUE                |   1996 | 4652674167.16561
 MOZAMBIQUE                |   1995 | 4663627061.33066
 MOZAMBIQUE                |   1994 | 4645426079.83939
 MOZAMBIQUE                |   1993 | 4634677827.47856
 MOZAMBIQUE                |   1992 | 4652938729.34524
 PERU                      |   1998 | 2721039427.58462
 PERU                      |   1997 | 4636329241.68786
 PERU                      |   1996 | 4620289368.47156
 PERU                      |   1995 | 4634222386.36888
 PERU                      |   1994 | 4639671744.53257
 PERU                      |   1993 | 4618781913.40866
 PERU                      |   1992 | 4632860475.26162
 ROMANIA                   |   1998 | 2739609216.33946
 ROMANIA                   |   1997 | 4655865157.21559
 ROMANIA                   |   1996 | 4668733446.25077
 ROMANIA                   |   1995 | 4652337308.65992
 ROMANIA                   |   1994 | 4652845339.70472
 ROMANIA                   |   1993 | 4661065272.06496
 ROMANIA                   |   1992 | 4672886963.64074
 RUSSIA                    |   1998 | 2728139208.63374
 RUSSIA                    |   1997 | 4676889406.98922
 RUSSIA                    |   1996 | 4670327514.21634
 RUSSIA                    |   1995 | 4648390545.66267
 RUSSIA                    |   1994 |  4666611972.5547
 RUSSIA                    |   1993 |  4655717989.6772
 RUSSIA                    |   1992 | 4715350687.74898
 SAUDI ARABIA              |   1998 | 2704024906.57285
 SAUDI ARABIA              |   1997 | 4632752354.73406
 SAUDI ARABIA              |   1996 | 4665074784.89969
 SAUDI ARABIA              |   1995 | 4629112021.41085
 SAUDI ARABIA              |   1994 | 4633441483.34307
 SAUDI ARABIA              |   1993 | 4647964186.80608
 SAUDI ARABIA              |   1992 | 4652880135.16772
 UNITED KINGDOM            |   1998 |  2744970249.1023
 UNITED KINGDOM            |   1997 | 4668626678.74299
 UNITED KINGDOM            |   1996 | 4687797630.18324
 UNITED KINGDOM            |   1995 | 4685036831.46338
 UNITED KINGDOM            |   1994 |  4669164211.0935
 UNITED KINGDOM            |   1993 | 4661639788.18244
 UNITED KINGDOM            |   1992 | 4681498038.30112
 UNITED STATES             |   1998 | 2714073338.40874
 UNITED STATES             |   1997 | 4664658025.37402
 UNITED STATES             |   1996 |  4688237245.7007
 UNITED STATES             |   1995 | 4644861796.29364
 UNITED STATES             |   1994 | 4682975912.32161
 UNITED STATES             |   1993 | 4675704465.70702
 UNITED STATES             |   1992 |  4684061901.6774
 VIETNAM                   |   1998 | 2754085744.13282
 VIETNAM                   |   1997 | 4644782709.63878
 VIETNAM                   |   1996 |  4667821416.6534
 VIETNAM                   |   1995 | 4679030214.54313
 VIETNAM                   |   1994 | 4676122830.58772
 VIETNAM                   |   1993 | 4679610062.03451
 VIETNAM                   |   1992 | 4648165405.76661
(175 rows)

COMMIT;
COMMIT
