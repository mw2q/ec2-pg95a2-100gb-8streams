BEGIN;
BEGIN
select
	nation,
	o_year,
	sum(amount) as sum_profit
from
	(
		select
			n_name as nation,
			extract(year from o_orderdate) as o_year,
			l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity as amount
		from
			part,
			supplier,
			lineitem,
			partsupp,
			orders,
			nation
		where
			s_suppkey = l_suppkey
			and ps_suppkey = l_suppkey
			and ps_partkey = l_partkey
			and p_partkey = l_partkey
			and o_orderkey = l_orderkey
			and s_nationkey = n_nationkey
			and p_name like '%ivory%'
	) as profit
group by
	nation,
	o_year
order by
	nation,
	o_year desc;
          nation           | o_year |    sum_profit    
---------------------------+--------+------------------
 ALGERIA                   |   1998 | 2742356120.88855
 ALGERIA                   |   1997 | 4669617496.73788
 ALGERIA                   |   1996 | 4683559659.46533
 ALGERIA                   |   1995 | 4672241818.24606
 ALGERIA                   |   1994 | 4661433544.76394
 ALGERIA                   |   1993 | 4682665238.71181
 ALGERIA                   |   1992 | 4674879916.20399
 ARGENTINA                 |   1998 | 2709409767.75005
 ARGENTINA                 |   1997 | 4625481549.69219
 ARGENTINA                 |   1996 | 4646523741.16102
 ARGENTINA                 |   1995 | 4618526448.90118
 ARGENTINA                 |   1994 | 4625577456.39294
 ARGENTINA                 |   1993 | 4646324661.15285
 ARGENTINA                 |   1992 | 4630567879.48051
 BRAZIL                    |   1998 | 2737859305.22553
 BRAZIL                    |   1997 | 4680500106.26595
 BRAZIL                    |   1996 | 4688988672.53332
 BRAZIL                    |   1995 | 4679577289.04737
 BRAZIL                    |   1994 | 4691886067.66084
 BRAZIL                    |   1993 | 4689738810.72616
 BRAZIL                    |   1992 | 4703621100.71741
 CANADA                    |   1998 | 2735729977.88193
 CANADA                    |   1997 | 4695311072.05357
 CANADA                    |   1996 | 4711314123.65728
 CANADA                    |   1995 | 4708524499.23829
 CANADA                    |   1994 | 4690894911.87688
 CANADA                    |   1993 | 4669171346.64301
 CANADA                    |   1992 | 4700916184.01043
 CHINA                     |   1998 |  2750179533.1941
 CHINA                     |   1997 | 4653512379.75573
 CHINA                     |   1996 | 4665198727.71721
 CHINA                     |   1995 |   4671975114.904
 CHINA                     |   1994 | 4649828753.88086
 CHINA                     |   1993 | 4667803617.94165
 CHINA                     |   1992 | 4672168848.62271
 EGYPT                     |   1998 | 2716382693.38311
 EGYPT                     |   1997 | 4658658445.08878
 EGYPT                     |   1996 | 4656051865.68162
 EGYPT                     |   1995 | 4651604667.27359
 EGYPT                     |   1994 |  4655303556.6497
 EGYPT                     |   1993 | 4661085232.09272
 EGYPT                     |   1992 | 4665520062.43859
 ETHIOPIA                  |   1998 | 2766597784.26646
 ETHIOPIA                  |   1997 | 4724191734.76403
 ETHIOPIA                  |   1996 | 4709749861.82713
 ETHIOPIA                  |   1995 | 4701429481.18176
 ETHIOPIA                  |   1994 | 4751138077.20488
 ETHIOPIA                  |   1993 |  4734057852.4882
 ETHIOPIA                  |   1992 | 4690615573.40963
 FRANCE                    |   1998 | 2725016108.92787
 FRANCE                    |   1997 | 4667178157.21947
 FRANCE                    |   1996 | 4681213720.71192
 FRANCE                    |   1995 |  4700848437.7071
 FRANCE                    |   1994 | 4701765880.74995
 FRANCE                    |   1993 | 4678626532.00356
 FRANCE                    |   1992 |  4693698585.8321
 GERMANY                   |   1998 | 2723698601.26695
 GERMANY                   |   1997 | 4682171723.07499
 GERMANY                   |   1996 | 4693870122.06593
 GERMANY                   |   1995 | 4669092128.77735
 GERMANY                   |   1994 | 4697590260.76505
 GERMANY                   |   1993 |  4670716856.9284
 GERMANY                   |   1992 | 4690506326.67964
 INDIA                     |   1998 | 2733667611.61951
 INDIA                     |   1997 | 4662496889.93115
 INDIA                     |   1996 |  4673148303.1927
 INDIA                     |   1995 | 4658823948.49459
 INDIA                     |   1994 | 4662770081.79859
 INDIA                     |   1993 | 4643312929.42678
 INDIA                     |   1992 | 4672265192.15251
 INDONESIA                 |   1998 | 2735318630.90488
 INDONESIA                 |   1997 | 4643101170.05797
 INDONESIA                 |   1996 | 4654556186.36769
 INDONESIA                 |   1995 | 4654312138.94308
 INDONESIA                 |   1994 | 4631043641.85769
 INDONESIA                 |   1993 |  4650218809.9967
 INDONESIA                 |   1992 | 4655517367.28273
 IRAN                      |   1998 |  2724117108.5405
 IRAN                      |   1997 | 4631645977.23179
 IRAN                      |   1996 | 4648185597.86174
 IRAN                      |   1995 | 4634252084.69291
 IRAN                      |   1994 | 4656028515.15366
 IRAN                      |   1993 | 4642318888.83671
 IRAN                      |   1992 | 4662074002.67271
 IRAQ                      |   1998 | 2712596689.09355
 IRAQ                      |   1997 | 4626580866.64907
 IRAQ                      |   1996 | 4656942379.38938
 IRAQ                      |   1995 |  4653123627.2668
 IRAQ                      |   1994 | 4623838419.53057
 IRAQ                      |   1993 | 4650101360.19285
 IRAQ                      |   1992 | 4652712718.50665
 JAPAN                     |   1998 | 2710730890.62357
 JAPAN                     |   1997 | 4619920386.99505
 JAPAN                     |   1996 | 4667107797.90511
 JAPAN                     |   1995 | 4644995457.13184
 JAPAN                     |   1994 | 4632291129.35876
 JAPAN                     |   1993 | 4617762979.96778
 JAPAN                     |   1992 | 4621697273.57255
 JORDAN                    |   1998 | 2749895954.44254
 JORDAN                    |   1997 | 4676914592.08924
 JORDAN                    |   1996 | 4681883081.76017
 JORDAN                    |   1995 | 4674864702.95043
 JORDAN                    |   1994 | 4688370115.39902
 JORDAN                    |   1993 | 4678062137.86009
 JORDAN                    |   1992 | 4688302744.04544
 KENYA                     |   1998 | 2720657488.79867
 KENYA                     |   1997 | 4634190458.27817
 KENYA                     |   1996 | 4642451035.20977
 KENYA                     |   1995 | 4640735261.57566
 KENYA                     |   1994 | 4667504641.68438
 KENYA                     |   1993 | 4624316868.84596
 KENYA                     |   1992 | 4635040867.31025
 MOROCCO                   |   1998 | 2736294829.01015
 MOROCCO                   |   1997 | 4678636537.26417
 MOROCCO                   |   1996 | 4673047817.76361
 MOROCCO                   |   1995 | 4662812898.16715
 MOROCCO                   |   1994 | 4668899884.42136
 MOROCCO                   |   1993 | 4665181839.87362
 MOROCCO                   |   1992 | 4675286656.52067
 MOZAMBIQUE                |   1998 | 2739707114.02889
 MOZAMBIQUE                |   1997 | 4692493950.63597
 MOZAMBIQUE                |   1996 | 4685316087.80159
 MOZAMBIQUE                |   1995 | 4679866817.83839
 MOZAMBIQUE                |   1994 | 4667333607.91853
 MOZAMBIQUE                |   1993 | 4701909855.70387
 MOZAMBIQUE                |   1992 | 4656838411.13092
 PERU                      |   1998 | 2714390947.44886
 PERU                      |   1997 | 4646629906.81331
 PERU                      |   1996 | 4643586966.39964
 PERU                      |   1995 | 4650393439.09221
 PERU                      |   1994 | 4643185504.53897
 PERU                      |   1993 | 4621484129.35903
 PERU                      |   1992 | 4665940707.98734
 ROMANIA                   |   1998 | 2738423047.70456
 ROMANIA                   |   1997 | 4669531580.94136
 ROMANIA                   |   1996 | 4672819810.76982
 ROMANIA                   |   1995 |  4661167455.6306
 ROMANIA                   |   1994 | 4665832020.76875
 ROMANIA                   |   1993 | 4702158052.61554
 ROMANIA                   |   1992 | 4704266472.42118
 RUSSIA                    |   1998 | 2724609225.84391
 RUSSIA                    |   1997 | 4666840345.16634
 RUSSIA                    |   1996 | 4689645856.24942
 RUSSIA                    |   1995 | 4678135868.12063
 RUSSIA                    |   1994 | 4655364768.73065
 RUSSIA                    |   1993 | 4653664803.48737
 RUSSIA                    |   1992 |  4659492955.2506
 SAUDI ARABIA              |   1998 | 2728582233.50211
 SAUDI ARABIA              |   1997 | 4656337874.92179
 SAUDI ARABIA              |   1996 | 4687936938.21412
 SAUDI ARABIA              |   1995 |  4673130715.9197
 SAUDI ARABIA              |   1994 | 4671679545.61787
 SAUDI ARABIA              |   1993 | 4686549741.98078
 SAUDI ARABIA              |   1992 | 4660527375.94323
 UNITED KINGDOM            |   1998 | 2755266643.07806
 UNITED KINGDOM            |   1997 |  4700351241.1856
 UNITED KINGDOM            |   1996 | 4716591867.49177
 UNITED KINGDOM            |   1995 |   4705505064.083
 UNITED KINGDOM            |   1994 | 4704287763.11897
 UNITED KINGDOM            |   1993 | 4673192446.35188
 UNITED KINGDOM            |   1992 | 4696954163.75707
 UNITED STATES             |   1998 | 2716766102.98469
 UNITED STATES             |   1997 | 4661996332.01324
 UNITED STATES             |   1996 | 4660764496.11012
 UNITED STATES             |   1995 | 4649292840.02484
 UNITED STATES             |   1994 | 4690626038.52784
 UNITED STATES             |   1993 | 4663896603.60763
 UNITED STATES             |   1992 | 4665757368.21569
 VIETNAM                   |   1998 | 2742857822.60323
 VIETNAM                   |   1997 |  4675493405.6934
 VIETNAM                   |   1996 | 4683844316.68701
 VIETNAM                   |   1995 |  4684678508.7933
 VIETNAM                   |   1994 | 4668582228.38926
 VIETNAM                   |   1993 | 4664380415.96606
 VIETNAM                   |   1992 | 4679798096.74197
(175 rows)

COMMIT;
COMMIT
