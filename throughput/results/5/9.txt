BEGIN;
BEGIN
select
	nation,
	o_year,
	sum(amount) as sum_profit
from
	(
		select
			n_name as nation,
			extract(year from o_orderdate) as o_year,
			l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity as amount
		from
			part,
			supplier,
			lineitem,
			partsupp,
			orders,
			nation
		where
			s_suppkey = l_suppkey
			and ps_suppkey = l_suppkey
			and ps_partkey = l_partkey
			and p_partkey = l_partkey
			and o_orderkey = l_orderkey
			and s_nationkey = n_nationkey
			and p_name like '%metallic%'
	) as profit
group by
	nation,
	o_year
order by
	nation,
	o_year desc;
          nation           | o_year |    sum_profit    
---------------------------+--------+------------------
 ALGERIA                   |   1998 | 2731468797.58421
 ALGERIA                   |   1997 | 4661828144.34177
 ALGERIA                   |   1996 | 4674814667.98187
 ALGERIA                   |   1995 |  4656946867.7654
 ALGERIA                   |   1994 | 4686961675.24288
 ALGERIA                   |   1993 | 4655743838.97491
 ALGERIA                   |   1992 | 4673178927.41867
 ARGENTINA                 |   1998 |  2714838843.8879
 ARGENTINA                 |   1997 | 4644308915.48013
 ARGENTINA                 |   1996 | 4640458221.38999
 ARGENTINA                 |   1995 | 4592554467.03354
 ARGENTINA                 |   1994 | 4622311855.17093
 ARGENTINA                 |   1993 | 4609942544.25187
 ARGENTINA                 |   1992 | 4635344070.05071
 BRAZIL                    |   1998 | 2740155057.52555
 BRAZIL                    |   1997 | 4659722086.94593
 BRAZIL                    |   1996 | 4676597593.42715
 BRAZIL                    |   1995 | 4659820805.96027
 BRAZIL                    |   1994 | 4662874158.75473
 BRAZIL                    |   1993 | 4658724287.64414
 BRAZIL                    |   1992 | 4686192363.17273
 CANADA                    |   1998 | 2746786672.87924
 CANADA                    |   1997 | 4657816040.71481
 CANADA                    |   1996 | 4704174766.85293
 CANADA                    |   1995 |  4676847679.9291
 CANADA                    |   1994 | 4681154650.52735
 CANADA                    |   1993 | 4678512770.06898
 CANADA                    |   1992 | 4673881108.05611
 CHINA                     |   1998 | 2731854344.16625
 CHINA                     |   1997 | 4660838102.63947
 CHINA                     |   1996 | 4703701826.57174
 CHINA                     |   1995 |  4662844481.9443
 CHINA                     |   1994 | 4645372513.58412
 CHINA                     |   1993 | 4660221787.05198
 CHINA                     |   1992 | 4685339735.63367
 EGYPT                     |   1998 | 2721044303.75257
 EGYPT                     |   1997 | 4672896386.73956
 EGYPT                     |   1996 | 4692374093.54665
 EGYPT                     |   1995 | 4678516209.56519
 EGYPT                     |   1994 | 4683769303.40935
 EGYPT                     |   1993 | 4677070093.61635
 EGYPT                     |   1992 |  4668597679.0871
 ETHIOPIA                  |   1998 | 2785398444.80184
 ETHIOPIA                  |   1997 | 4716965610.68687
 ETHIOPIA                  |   1996 | 4729978744.72611
 ETHIOPIA                  |   1995 | 4712326011.95244
 ETHIOPIA                  |   1994 | 4748636147.93061
 ETHIOPIA                  |   1993 | 4729957742.72407
 ETHIOPIA                  |   1992 | 4753365332.49225
 FRANCE                    |   1998 | 2742558887.17037
 FRANCE                    |   1997 | 4655134402.04571
 FRANCE                    |   1996 |    4671958078.34
 FRANCE                    |   1995 | 4676259304.69807
 FRANCE                    |   1994 | 4659652344.67562
 FRANCE                    |   1993 | 4672771784.78585
 FRANCE                    |   1992 | 4657355119.26969
 GERMANY                   |   1998 | 2748936077.68011
 GERMANY                   |   1997 | 4672468575.00324
 GERMANY                   |   1996 | 4682406465.69583
 GERMANY                   |   1995 | 4675761691.47416
 GERMANY                   |   1994 | 4692637318.79795
 GERMANY                   |   1993 | 4655093784.86597
 GERMANY                   |   1992 |  4662893657.3494
 INDIA                     |   1998 | 2745320208.70212
 INDIA                     |   1997 | 4660088758.54361
 INDIA                     |   1996 | 4661429445.14765
 INDIA                     |   1995 | 4653203708.25888
 INDIA                     |   1994 | 4646499425.16063
 INDIA                     |   1993 | 4651697995.20579
 INDIA                     |   1992 | 4698660984.48198
 INDONESIA                 |   1998 | 2724099928.34918
 INDONESIA                 |   1997 | 4649786739.66897
 INDONESIA                 |   1996 | 4620943805.61813
 INDONESIA                 |   1995 | 4658816595.60179
 INDONESIA                 |   1994 | 4640425290.96624
 INDONESIA                 |   1993 | 4630665456.66121
 INDONESIA                 |   1992 | 4651359993.80389
 IRAN                      |   1998 | 2724834379.73592
 IRAN                      |   1997 | 4654173246.28298
 IRAN                      |   1996 | 4666314992.59226
 IRAN                      |   1995 |  4657879956.5073
 IRAN                      |   1994 | 4673690572.39743
 IRAN                      |   1993 | 4661612003.54379
 IRAN                      |   1992 | 4662637305.76079
 IRAQ                      |   1998 | 2714320679.66735
 IRAQ                      |   1997 | 4606670894.12201
 IRAQ                      |   1996 | 4629343024.02551
 IRAQ                      |   1995 | 4640698718.65525
 IRAQ                      |   1994 | 4611624609.03815
 IRAQ                      |   1993 | 4625391624.73965
 IRAQ                      |   1992 |   4651815027.629
 JAPAN                     |   1998 | 2729684745.09147
 JAPAN                     |   1997 | 4645926259.00499
 JAPAN                     |   1996 | 4637237068.39992
 JAPAN                     |   1995 | 4647862284.04516
 JAPAN                     |   1994 | 4651622756.90921
 JAPAN                     |   1993 | 4615950890.49549
 JAPAN                     |   1992 | 4660818950.28029
 JORDAN                    |   1998 | 2738427946.93938
 JORDAN                    |   1997 | 4651455128.20776
 JORDAN                    |   1996 | 4681847313.60704
 JORDAN                    |   1995 | 4637415345.12593
 JORDAN                    |   1994 | 4658876517.66774
 JORDAN                    |   1993 | 4644093009.61681
 JORDAN                    |   1992 | 4630282156.23587
 KENYA                     |   1998 | 2727350173.33331
 KENYA                     |   1997 | 4657338143.30097
 KENYA                     |   1996 | 4658583880.58741
 KENYA                     |   1995 | 4616672052.80147
 KENYA                     |   1994 |  4657532236.6834
 KENYA                     |   1993 | 4648806245.91176
 KENYA                     |   1992 | 4669506042.28435
 MOROCCO                   |   1998 | 2716168321.58993
 MOROCCO                   |   1997 | 4674817529.20388
 MOROCCO                   |   1996 | 4668750407.54794
 MOROCCO                   |   1995 | 4659290580.73691
 MOROCCO                   |   1994 | 4639023195.33705
 MOROCCO                   |   1993 | 4659063414.19649
 MOROCCO                   |   1992 | 4661461242.00715
 MOZAMBIQUE                |   1998 | 2734318672.98285
 MOZAMBIQUE                |   1997 | 4648105856.41508
 MOZAMBIQUE                |   1996 | 4655576945.22011
 MOZAMBIQUE                |   1995 |  4637156204.6667
 MOZAMBIQUE                |   1994 | 4646875255.91939
 MOZAMBIQUE                |   1993 | 4671941926.10215
 MOZAMBIQUE                |   1992 |  4659955331.6655
 PERU                      |   1998 |  2710512718.9387
 PERU                      |   1997 | 4641287480.27474
 PERU                      |   1996 | 4641303698.95262
 PERU                      |   1995 | 4643910626.38241
 PERU                      |   1994 | 4639030943.16306
 PERU                      |   1993 | 4625062039.24064
 PERU                      |   1992 | 4646675578.50966
 ROMANIA                   |   1998 | 2751142821.27875
 ROMANIA                   |   1997 | 4667879604.58163
 ROMANIA                   |   1996 | 4693742148.78145
 ROMANIA                   |   1995 | 4690793080.27287
 ROMANIA                   |   1994 | 4677031768.48294
 ROMANIA                   |   1993 |  4657444808.2571
 ROMANIA                   |   1992 | 4670520286.36713
 RUSSIA                    |   1998 | 2723428971.08731
 RUSSIA                    |   1997 | 4658944201.93606
 RUSSIA                    |   1996 | 4666141345.53668
 RUSSIA                    |   1995 | 4668230523.35394
 RUSSIA                    |   1994 |  4658734064.6103
 RUSSIA                    |   1993 | 4672446379.08711
 RUSSIA                    |   1992 | 4661876932.79177
 SAUDI ARABIA              |   1998 | 2719134853.14639
 SAUDI ARABIA              |   1997 | 4670966022.74559
 SAUDI ARABIA              |   1996 | 4653776341.57578
 SAUDI ARABIA              |   1995 | 4673021296.60236
 SAUDI ARABIA              |   1994 | 4657086590.09143
 SAUDI ARABIA              |   1993 | 4676399267.18013
 SAUDI ARABIA              |   1992 | 4653842135.48505
 UNITED KINGDOM            |   1998 | 2769940534.92549
 UNITED KINGDOM            |   1997 | 4731573290.86465
 UNITED KINGDOM            |   1996 | 4729781249.96472
 UNITED KINGDOM            |   1995 | 4706527150.07853
 UNITED KINGDOM            |   1994 | 4717102907.54689
 UNITED KINGDOM            |   1993 | 4700193735.37149
 UNITED KINGDOM            |   1992 | 4733037161.63138
 UNITED STATES             |   1998 | 2740356541.97787
 UNITED STATES             |   1997 | 4637995513.11081
 UNITED STATES             |   1996 | 4695503139.54997
 UNITED STATES             |   1995 | 4647763299.04382
 UNITED STATES             |   1994 |  4686615960.5739
 UNITED STATES             |   1993 | 4657817309.89068
 UNITED STATES             |   1992 | 4671889054.79579
 VIETNAM                   |   1998 | 2740196139.50243
 VIETNAM                   |   1997 | 4691093065.83684
 VIETNAM                   |   1996 | 4716762817.74828
 VIETNAM                   |   1995 | 4684716905.46195
 VIETNAM                   |   1994 | 4682228381.57012
 VIETNAM                   |   1993 | 4683186294.51681
 VIETNAM                   |   1992 | 4701960826.77148
(175 rows)

COMMIT;
COMMIT
