BEGIN;
BEGIN
select
	nation,
	o_year,
	sum(amount) as sum_profit
from
	(
		select
			n_name as nation,
			extract(year from o_orderdate) as o_year,
			l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity as amount
		from
			part,
			supplier,
			lineitem,
			partsupp,
			orders,
			nation
		where
			s_suppkey = l_suppkey
			and ps_suppkey = l_suppkey
			and ps_partkey = l_partkey
			and p_partkey = l_partkey
			and o_orderkey = l_orderkey
			and s_nationkey = n_nationkey
			and p_name like '%peach%'
	) as profit
group by
	nation,
	o_year
order by
	nation,
	o_year desc;
          nation           | o_year |    sum_profit    
---------------------------+--------+------------------
 ALGERIA                   |   1998 |   2759229475.843
 ALGERIA                   |   1997 | 4667158699.68857
 ALGERIA                   |   1996 | 4709084852.65671
 ALGERIA                   |   1995 |  4671147557.4419
 ALGERIA                   |   1994 | 4689133200.99495
 ALGERIA                   |   1993 | 4652679637.43012
 ALGERIA                   |   1992 | 4674767889.85551
 ARGENTINA                 |   1998 | 2702089109.88012
 ARGENTINA                 |   1997 |  4631207870.1475
 ARGENTINA                 |   1996 | 4613323294.01366
 ARGENTINA                 |   1995 | 4601206753.00499
 ARGENTINA                 |   1994 | 4595509233.39589
 ARGENTINA                 |   1993 | 4623019066.61213
 ARGENTINA                 |   1992 | 4658465436.07394
 BRAZIL                    |   1998 | 2734085646.21446
 BRAZIL                    |   1997 | 4641265214.08755
 BRAZIL                    |   1996 | 4658182190.79977
 BRAZIL                    |   1995 | 4641731065.75968
 BRAZIL                    |   1994 | 4619719539.32689
 BRAZIL                    |   1993 | 4645335217.29004
 BRAZIL                    |   1992 |    4683646701.72
 CANADA                    |   1998 | 2753132075.55231
 CANADA                    |   1997 | 4669165013.31979
 CANADA                    |   1996 | 4676374617.13651
 CANADA                    |   1995 | 4669750193.57169
 CANADA                    |   1994 | 4684444462.55822
 CANADA                    |   1993 | 4687541836.45838
 CANADA                    |   1992 | 4679019389.41721
 CHINA                     |   1998 | 2734920033.58932
 CHINA                     |   1997 |   4698502692.596
 CHINA                     |   1996 | 4701173046.89045
 CHINA                     |   1995 | 4670538096.73184
 CHINA                     |   1994 |  4681120516.3934
 CHINA                     |   1993 |  4659993029.7838
 CHINA                     |   1992 | 4681522933.89037
 EGYPT                     |   1998 | 2729858936.30253
 EGYPT                     |   1997 | 4666611114.17947
 EGYPT                     |   1996 | 4696448465.75522
 EGYPT                     |   1995 | 4671273273.64429
 EGYPT                     |   1994 | 4657961983.48672
 EGYPT                     |   1993 | 4677893724.91677
 EGYPT                     |   1992 | 4687717743.54675
 ETHIOPIA                  |   1998 |  2750172067.0352
 ETHIOPIA                  |   1997 |  4703756583.5542
 ETHIOPIA                  |   1996 | 4708682620.62729
 ETHIOPIA                  |   1995 | 4725740627.41998
 ETHIOPIA                  |   1994 | 4713525152.67149
 ETHIOPIA                  |   1993 | 4676987169.41092
 ETHIOPIA                  |   1992 | 4713393821.23918
 FRANCE                    |   1998 | 2715608532.10166
 FRANCE                    |   1997 | 4628296095.23672
 FRANCE                    |   1996 | 4680848976.32614
 FRANCE                    |   1995 | 4632906287.95521
 FRANCE                    |   1994 | 4646860297.96069
 FRANCE                    |   1993 | 4643231223.40011
 FRANCE                    |   1992 | 4643204764.43029
 GERMANY                   |   1998 | 2720220076.98185
 GERMANY                   |   1997 | 4682281111.10591
 GERMANY                   |   1996 | 4695989361.38501
 GERMANY                   |   1995 | 4665515867.14859
 GERMANY                   |   1994 | 4649188630.53523
 GERMANY                   |   1993 | 4686883205.10441
 GERMANY                   |   1992 |  4695755188.4965
 INDIA                     |   1998 |  2755846075.8769
 INDIA                     |   1997 | 4703166848.75209
 INDIA                     |   1996 | 4689436565.20986
 INDIA                     |   1995 | 4680860708.13734
 INDIA                     |   1994 | 4687398443.56365
 INDIA                     |   1993 | 4680595258.81674
 INDIA                     |   1992 | 4718720636.71273
 INDONESIA                 |   1998 | 2735579650.93743
 INDONESIA                 |   1997 | 4644403639.74545
 INDONESIA                 |   1996 | 4639945060.56835
 INDONESIA                 |   1995 | 4641526440.75467
 INDONESIA                 |   1994 | 4663838246.06297
 INDONESIA                 |   1993 | 4609625270.92953
 INDONESIA                 |   1992 | 4629991451.25896
 IRAN                      |   1998 | 2720412477.95419
 IRAN                      |   1997 | 4659058447.16161
 IRAN                      |   1996 | 4646540207.48597
 IRAN                      |   1995 | 4654081409.65752
 IRAN                      |   1994 | 4639228814.90518
 IRAN                      |   1993 | 4652185231.33682
 IRAN                      |   1992 | 4649587000.77674
 IRAQ                      |   1998 |  2719524477.5837
 IRAQ                      |   1997 | 4646787643.47582
 IRAQ                      |   1996 | 4669977346.12182
 IRAQ                      |   1995 | 4644041121.77623
 IRAQ                      |   1994 | 4659848067.72839
 IRAQ                      |   1993 | 4664922038.52767
 IRAQ                      |   1992 | 4650301936.62367
 JAPAN                     |   1998 | 2707752024.10767
 JAPAN                     |   1997 |  4596416564.6624
 JAPAN                     |   1996 | 4609836257.72887
 JAPAN                     |   1995 | 4621004209.29289
 JAPAN                     |   1994 | 4631155237.16267
 JAPAN                     |   1993 | 4615680073.08594
 JAPAN                     |   1992 |  4639983868.6778
 JORDAN                    |   1998 | 2742586728.21283
 JORDAN                    |   1997 | 4679724242.05096
 JORDAN                    |   1996 | 4675700123.80446
 JORDAN                    |   1995 | 4677291029.73695
 JORDAN                    |   1994 |  4634141302.8184
 JORDAN                    |   1993 | 4659306911.55846
 JORDAN                    |   1992 | 4652584120.99844
 KENYA                     |   1998 | 2728591152.90188
 KENYA                     |   1997 | 4619239854.39408
 KENYA                     |   1996 | 4639990633.40862
 KENYA                     |   1995 | 4621369543.60178
 KENYA                     |   1994 | 4622785378.93943
 KENYA                     |   1993 | 4605452163.85942
 KENYA                     |   1992 | 4626277764.24343
 MOROCCO                   |   1998 | 2758617283.78707
 MOROCCO                   |   1997 | 4699632604.42927
 MOROCCO                   |   1996 | 4687788847.88616
 MOROCCO                   |   1995 | 4691398565.65447
 MOROCCO                   |   1994 | 4718853795.90154
 MOROCCO                   |   1993 | 4680707008.86437
 MOROCCO                   |   1992 | 4699177753.84359
 MOZAMBIQUE                |   1998 | 2728745850.00859
 MOZAMBIQUE                |   1997 | 4671176460.95705
 MOZAMBIQUE                |   1996 | 4712841392.80733
 MOZAMBIQUE                |   1995 | 4692849247.10766
 MOZAMBIQUE                |   1994 | 4691089574.09546
 MOZAMBIQUE                |   1993 | 4687694805.81615
 MOZAMBIQUE                |   1992 | 4726205783.07337
 PERU                      |   1998 | 2721594166.44421
 PERU                      |   1997 | 4618943831.00165
 PERU                      |   1996 |  4656030749.3525
 PERU                      |   1995 |  4625874291.0358
 PERU                      |   1994 | 4640196548.18414
 PERU                      |   1993 | 4619673267.99297
 PERU                      |   1992 | 4667237564.66701
 ROMANIA                   |   1998 | 2741007373.79245
 ROMANIA                   |   1997 |  4656148882.5764
 ROMANIA                   |   1996 | 4639366210.46523
 ROMANIA                   |   1995 | 4667889474.08431
 ROMANIA                   |   1994 | 4671695685.40312
 ROMANIA                   |   1993 |  4655361093.4416
 ROMANIA                   |   1992 | 4664374347.88707
 RUSSIA                    |   1998 | 2711412781.31364
 RUSSIA                    |   1997 | 4643397035.58679
 RUSSIA                    |   1996 | 4673726790.63208
 RUSSIA                    |   1995 | 4676123049.45973
 RUSSIA                    |   1994 | 4661991181.83256
 RUSSIA                    |   1993 | 4672716102.69876
 RUSSIA                    |   1992 |  4690922453.0413
 SAUDI ARABIA              |   1998 | 2725101346.33645
 SAUDI ARABIA              |   1997 | 4619719057.88224
 SAUDI ARABIA              |   1996 | 4655465504.09408
 SAUDI ARABIA              |   1995 | 4644059825.95308
 SAUDI ARABIA              |   1994 | 4658877588.04521
 SAUDI ARABIA              |   1993 |  4649750447.1499
 SAUDI ARABIA              |   1992 | 4657803573.30192
 UNITED KINGDOM            |   1998 | 2752639702.55856
 UNITED KINGDOM            |   1997 |   4670379646.829
 UNITED KINGDOM            |   1996 | 4672615707.37401
 UNITED KINGDOM            |   1995 | 4683939160.70652
 UNITED KINGDOM            |   1994 | 4670825188.05418
 UNITED KINGDOM            |   1993 | 4664932161.81703
 UNITED KINGDOM            |   1992 | 4684731772.77893
 UNITED STATES             |   1998 | 2763738389.55763
 UNITED STATES             |   1997 | 4683644757.15342
 UNITED STATES             |   1996 | 4709538430.65257
 UNITED STATES             |   1995 |  4669183705.5736
 UNITED STATES             |   1994 | 4704288121.93712
 UNITED STATES             |   1993 | 4682418324.15545
 UNITED STATES             |   1992 | 4684258885.21237
 VIETNAM                   |   1998 | 2754257553.80955
 VIETNAM                   |   1997 | 4675744410.26099
 VIETNAM                   |   1996 | 4688759644.70614
 VIETNAM                   |   1995 | 4687712635.62946
 VIETNAM                   |   1994 | 4699934189.41625
 VIETNAM                   |   1993 | 4690924135.73905
 VIETNAM                   |   1992 | 4698863676.60293
(175 rows)

COMMIT;
COMMIT
