BEGIN;
BEGIN
select
	nation,
	o_year,
	sum(amount) as sum_profit
from
	(
		select
			n_name as nation,
			extract(year from o_orderdate) as o_year,
			l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity as amount
		from
			part,
			supplier,
			lineitem,
			partsupp,
			orders,
			nation
		where
			s_suppkey = l_suppkey
			and ps_suppkey = l_suppkey
			and ps_partkey = l_partkey
			and p_partkey = l_partkey
			and o_orderkey = l_orderkey
			and s_nationkey = n_nationkey
			and p_name like '%purple%'
	) as profit
group by
	nation,
	o_year
order by
	nation,
	o_year desc;
          nation           | o_year |    sum_profit    
---------------------------+--------+------------------
 ALGERIA                   |   1998 | 2736129924.09575
 ALGERIA                   |   1997 | 4679582603.07641
 ALGERIA                   |   1996 | 4661826878.71177
 ALGERIA                   |   1995 | 4662484919.60198
 ALGERIA                   |   1994 | 4675622396.92073
 ALGERIA                   |   1993 | 4675478652.88823
 ALGERIA                   |   1992 | 4657328894.18831
 ARGENTINA                 |   1998 | 2732023933.64187
 ARGENTINA                 |   1997 | 4651085603.24075
 ARGENTINA                 |   1996 | 4690233120.20845
 ARGENTINA                 |   1995 | 4662542321.71997
 ARGENTINA                 |   1994 | 4648957019.41898
 ARGENTINA                 |   1993 | 4668701480.37471
 ARGENTINA                 |   1992 |  4671891324.4987
 BRAZIL                    |   1998 | 2716042306.47098
 BRAZIL                    |   1997 | 4672345487.61626
 BRAZIL                    |   1996 | 4662157981.85695
 BRAZIL                    |   1995 |  4658212335.8196
 BRAZIL                    |   1994 | 4662953102.40268
 BRAZIL                    |   1993 | 4665943207.74809
 BRAZIL                    |   1992 | 4689036302.54206
 CANADA                    |   1998 | 2746714765.77858
 CANADA                    |   1997 | 4698789964.22955
 CANADA                    |   1996 | 4669977845.67097
 CANADA                    |   1995 | 4701039782.02207
 CANADA                    |   1994 | 4703983221.74871
 CANADA                    |   1993 | 4690460121.66836
 CANADA                    |   1992 | 4678960170.82745
 CHINA                     |   1998 | 2713799848.40332
 CHINA                     |   1997 | 4658109180.64018
 CHINA                     |   1996 | 4636990686.48984
 CHINA                     |   1995 | 4643356882.33586
 CHINA                     |   1994 | 4637537855.21806
 CHINA                     |   1993 | 4625126920.91105
 CHINA                     |   1992 | 4679425963.87219
 EGYPT                     |   1998 | 2724226101.52304
 EGYPT                     |   1997 | 4668224351.28535
 EGYPT                     |   1996 | 4678348980.71826
 EGYPT                     |   1995 | 4662209946.28763
 EGYPT                     |   1994 | 4668937813.73117
 EGYPT                     |   1993 |  4662988595.9131
 EGYPT                     |   1992 | 4667278537.65873
 ETHIOPIA                  |   1998 | 2768901391.29741
 ETHIOPIA                  |   1997 | 4728467483.96161
 ETHIOPIA                  |   1996 | 4748013211.58063
 ETHIOPIA                  |   1995 | 4709996114.17646
 ETHIOPIA                  |   1994 | 4727718368.69397
 ETHIOPIA                  |   1993 | 4714153207.69473
 ETHIOPIA                  |   1992 | 4712821946.46532
 FRANCE                    |   1998 | 2730936286.60602
 FRANCE                    |   1997 | 4662999361.44405
 FRANCE                    |   1996 | 4664611491.36613
 FRANCE                    |   1995 | 4650070252.12915
 FRANCE                    |   1994 | 4635504698.04703
 FRANCE                    |   1993 | 4643676170.17424
 FRANCE                    |   1992 | 4672896658.10229
 GERMANY                   |   1998 | 2748746108.46316
 GERMANY                   |   1997 | 4701211346.24423
 GERMANY                   |   1996 | 4698846275.52643
 GERMANY                   |   1995 | 4660603967.80793
 GERMANY                   |   1994 | 4672602889.34918
 GERMANY                   |   1993 | 4672651610.84815
 GERMANY                   |   1992 | 4669155194.85849
 INDIA                     |   1998 |  2745197921.8288
 INDIA                     |   1997 | 4671138810.25103
 INDIA                     |   1996 | 4676422360.53716
 INDIA                     |   1995 | 4668187307.36589
 INDIA                     |   1994 | 4677205803.34409
 INDIA                     |   1993 | 4673458424.20806
 INDIA                     |   1992 | 4682265771.36077
 INDONESIA                 |   1998 | 2728196287.58757
 INDONESIA                 |   1997 | 4641231773.49202
 INDONESIA                 |   1996 | 4612134688.03631
 INDONESIA                 |   1995 |   4628303376.049
 INDONESIA                 |   1994 |  4649994945.0336
 INDONESIA                 |   1993 | 4630103459.98718
 INDONESIA                 |   1992 | 4637541107.73568
 IRAN                      |   1998 | 2731200554.71538
 IRAN                      |   1997 | 4648325663.10929
 IRAN                      |   1996 | 4636331875.31242
 IRAN                      |   1995 | 4638233251.67263
 IRAN                      |   1994 | 4655878924.89755
 IRAN                      |   1993 | 4663976142.13875
 IRAN                      |   1992 | 4666471287.76185
 IRAQ                      |   1998 | 2713747550.16368
 IRAQ                      |   1997 | 4626723514.04899
 IRAQ                      |   1996 | 4667592689.40782
 IRAQ                      |   1995 | 4638876285.22486
 IRAQ                      |   1994 | 4653244102.59523
 IRAQ                      |   1993 | 4653160032.40357
 IRAQ                      |   1992 | 4667689686.82985
 JAPAN                     |   1998 | 2712612435.16455
 JAPAN                     |   1997 |  4613726781.2403
 JAPAN                     |   1996 | 4626236114.85221
 JAPAN                     |   1995 | 4651474226.31426
 JAPAN                     |   1994 | 4632301996.49712
 JAPAN                     |   1993 | 4622411408.43854
 JAPAN                     |   1992 | 4646787310.68532
 JORDAN                    |   1998 | 2750820848.47248
 JORDAN                    |   1997 | 4678908491.25674
 JORDAN                    |   1996 | 4695251632.69275
 JORDAN                    |   1995 | 4682093006.99239
 JORDAN                    |   1994 | 4675408911.90377
 JORDAN                    |   1993 | 4685722680.08338
 JORDAN                    |   1992 | 4688452923.97331
 KENYA                     |   1998 | 2723162412.77544
 KENYA                     |   1997 | 4621002262.01995
 KENYA                     |   1996 |  4642447760.2982
 KENYA                     |   1995 | 4632315424.14262
 KENYA                     |   1994 | 4638885529.49537
 KENYA                     |   1993 | 4644832661.31082
 KENYA                     |   1992 | 4664843616.27942
 MOROCCO                   |   1998 |  2761282336.2398
 MOROCCO                   |   1997 | 4680540750.82797
 MOROCCO                   |   1996 | 4700451188.82135
 MOROCCO                   |   1995 | 4673199100.08001
 MOROCCO                   |   1994 | 4688581772.75751
 MOROCCO                   |   1993 | 4689796827.28207
 MOROCCO                   |   1992 | 4706353571.85542
 MOZAMBIQUE                |   1998 | 2748639936.10093
 MOZAMBIQUE                |   1997 | 4676637789.34929
 MOZAMBIQUE                |   1996 | 4686808484.11761
 MOZAMBIQUE                |   1995 | 4652014846.12997
 MOZAMBIQUE                |   1994 | 4655573650.66628
 MOZAMBIQUE                |   1993 | 4659621953.00481
 MOZAMBIQUE                |   1992 | 4667784222.61682
 PERU                      |   1998 | 2722682875.09371
 PERU                      |   1997 | 4640511471.53922
 PERU                      |   1996 | 4643587632.13872
 PERU                      |   1995 |  4632281579.2415
 PERU                      |   1994 | 4637205224.14736
 PERU                      |   1993 | 4629864736.31408
 PERU                      |   1992 | 4647255984.59048
 ROMANIA                   |   1998 | 2751164913.46516
 ROMANIA                   |   1997 |  4680818550.0138
 ROMANIA                   |   1996 | 4711508244.90509
 ROMANIA                   |   1995 | 4678807429.46784
 ROMANIA                   |   1994 | 4720242712.01312
 ROMANIA                   |   1993 | 4664258721.21731
 ROMANIA                   |   1992 | 4696830212.26062
 RUSSIA                    |   1998 | 2732020176.65267
 RUSSIA                    |   1997 | 4679096841.32092
 RUSSIA                    |   1996 | 4700834776.93341
 RUSSIA                    |   1995 | 4649519775.67087
 RUSSIA                    |   1994 | 4688072261.68802
 RUSSIA                    |   1993 | 4675635380.29035
 RUSSIA                    |   1992 | 4672849927.77515
 SAUDI ARABIA              |   1998 | 2729947459.08497
 SAUDI ARABIA              |   1997 | 4654975844.86296
 SAUDI ARABIA              |   1996 | 4665190029.66375
 SAUDI ARABIA              |   1995 |  4642497863.5181
 SAUDI ARABIA              |   1994 |  4669051110.1947
 SAUDI ARABIA              |   1993 | 4669120812.63064
 SAUDI ARABIA              |   1992 |  4674466942.2427
 UNITED KINGDOM            |   1998 | 2773447530.12992
 UNITED KINGDOM            |   1997 | 4713233459.48059
 UNITED KINGDOM            |   1996 | 4707545324.08241
 UNITED KINGDOM            |   1995 | 4674261488.24235
 UNITED KINGDOM            |   1994 | 4712443984.56038
 UNITED KINGDOM            |   1993 | 4689517792.64287
 UNITED KINGDOM            |   1992 |  4716381075.5455
 UNITED STATES             |   1998 | 2731336776.65251
 UNITED STATES             |   1997 | 4661700100.13564
 UNITED STATES             |   1996 | 4681357248.64157
 UNITED STATES             |   1995 |  4654495056.2386
 UNITED STATES             |   1994 | 4670856351.57139
 UNITED STATES             |   1993 | 4672085422.86145
 UNITED STATES             |   1992 | 4682883583.98394
 VIETNAM                   |   1998 | 2737202831.78809
 VIETNAM                   |   1997 | 4701169014.62029
 VIETNAM                   |   1996 | 4726393982.74017
 VIETNAM                   |   1995 | 4716186907.31888
 VIETNAM                   |   1994 |  4693968363.6486
 VIETNAM                   |   1993 | 4695331545.08615
 VIETNAM                   |   1992 | 4719511022.47286
(175 rows)

COMMIT;
COMMIT
