BEGIN;
BEGIN
select
	nation,
	o_year,
	sum(amount) as sum_profit
from
	(
		select
			n_name as nation,
			extract(year from o_orderdate) as o_year,
			l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity as amount
		from
			part,
			supplier,
			lineitem,
			partsupp,
			orders,
			nation
		where
			s_suppkey = l_suppkey
			and ps_suppkey = l_suppkey
			and ps_partkey = l_partkey
			and p_partkey = l_partkey
			and o_orderkey = l_orderkey
			and s_nationkey = n_nationkey
			and p_name like '%smoke%'
	) as profit
group by
	nation,
	o_year
order by
	nation,
	o_year desc;
          nation           | o_year |    sum_profit    
---------------------------+--------+------------------
 ALGERIA                   |   1998 | 2715419876.20711
 ALGERIA                   |   1997 | 4622014974.57014
 ALGERIA                   |   1996 | 4651001322.99307
 ALGERIA                   |   1995 | 4653387748.03158
 ALGERIA                   |   1994 | 4624226139.43203
 ALGERIA                   |   1993 | 4665976391.74705
 ALGERIA                   |   1992 | 4666585493.20483
 ARGENTINA                 |   1998 | 2712917310.01386
 ARGENTINA                 |   1997 | 4607483669.28295
 ARGENTINA                 |   1996 | 4629214001.83442
 ARGENTINA                 |   1995 | 4608353802.48087
 ARGENTINA                 |   1994 | 4619488159.63621
 ARGENTINA                 |   1993 | 4634400649.47535
 ARGENTINA                 |   1992 | 4617005439.10288
 BRAZIL                    |   1998 | 2716333041.09316
 BRAZIL                    |   1997 | 4640082532.45798
 BRAZIL                    |   1996 | 4668328706.25684
 BRAZIL                    |   1995 | 4665652409.21711
 BRAZIL                    |   1994 | 4630144669.74068
 BRAZIL                    |   1993 | 4649702318.14968
 BRAZIL                    |   1992 | 4661066141.73943
 CANADA                    |   1998 | 2746976917.89231
 CANADA                    |   1997 |  4704332875.8125
 CANADA                    |   1996 | 4708484301.48415
 CANADA                    |   1995 | 4693526045.93715
 CANADA                    |   1994 | 4707440336.80403
 CANADA                    |   1993 | 4677616553.32432
 CANADA                    |   1992 | 4726315732.49433
 CHINA                     |   1998 | 2736477165.42693
 CHINA                     |   1997 | 4664994477.08312
 CHINA                     |   1996 | 4643814298.89785
 CHINA                     |   1995 | 4686059326.46854
 CHINA                     |   1994 |  4644252024.6743
 CHINA                     |   1993 | 4675929551.26768
 CHINA                     |   1992 |  4674568081.9754
 EGYPT                     |   1998 | 2724984260.37074
 EGYPT                     |   1997 | 4674801392.69231
 EGYPT                     |   1996 | 4701137857.29123
 EGYPT                     |   1995 | 4662132535.40464
 EGYPT                     |   1994 | 4654525959.94614
 EGYPT                     |   1993 | 4685024018.85908
 EGYPT                     |   1992 | 4693336224.39764
 ETHIOPIA                  |   1998 | 2776907545.59921
 ETHIOPIA                  |   1997 | 4706562285.26445
 ETHIOPIA                  |   1996 | 4719717980.33906
 ETHIOPIA                  |   1995 | 4696420708.46557
 ETHIOPIA                  |   1994 | 4715842816.84051
 ETHIOPIA                  |   1993 | 4707098096.35496
 ETHIOPIA                  |   1992 | 4692579672.95725
 FRANCE                    |   1998 | 2736914586.55815
 FRANCE                    |   1997 | 4691744820.05063
 FRANCE                    |   1996 | 4714880148.78613
 FRANCE                    |   1995 | 4675157584.82708
 FRANCE                    |   1994 | 4698561587.65067
 FRANCE                    |   1993 |   4695312521.476
 FRANCE                    |   1992 | 4687259967.44667
 GERMANY                   |   1998 | 2740712803.90104
 GERMANY                   |   1997 | 4645657987.35456
 GERMANY                   |   1996 |  4683736548.9524
 GERMANY                   |   1995 | 4652202864.50519
 GERMANY                   |   1994 | 4663624551.00815
 GERMANY                   |   1993 | 4662315113.63455
 GERMANY                   |   1992 | 4667086296.95126
 INDIA                     |   1998 | 2742976327.23564
 INDIA                     |   1997 | 4666718684.22926
 INDIA                     |   1996 | 4690798966.82731
 INDIA                     |   1995 | 4659016551.97897
 INDIA                     |   1994 | 4648931562.33441
 INDIA                     |   1993 | 4649238935.53723
 INDIA                     |   1992 |  4691473978.0558
 INDONESIA                 |   1998 |  2705231172.8386
 INDONESIA                 |   1997 | 4634167458.47229
 INDONESIA                 |   1996 |   4601548789.891
 INDONESIA                 |   1995 | 4628853942.12367
 INDONESIA                 |   1994 | 4605807406.95582
 INDONESIA                 |   1993 |  4591235718.9432
 INDONESIA                 |   1992 | 4589488462.36613
 IRAN                      |   1998 | 2727774580.93724
 IRAN                      |   1997 | 4684836417.20472
 IRAN                      |   1996 |  4688463879.9817
 IRAN                      |   1995 | 4663539274.50766
 IRAN                      |   1994 | 4662257846.48562
 IRAN                      |   1993 | 4658929395.82413
 IRAN                      |   1992 | 4663963660.25807
 IRAQ                      |   1998 | 2740611116.50243
 IRAQ                      |   1997 | 4674316630.32725
 IRAQ                      |   1996 | 4669267059.82589
 IRAQ                      |   1995 | 4682792057.08045
 IRAQ                      |   1994 | 4651258948.61051
 IRAQ                      |   1993 | 4673247204.25017
 IRAQ                      |   1992 | 4668311440.79419
 JAPAN                     |   1998 | 2711197012.73947
 JAPAN                     |   1997 | 4633612541.66356
 JAPAN                     |   1996 | 4677888067.05921
 JAPAN                     |   1995 | 4647251656.98032
 JAPAN                     |   1994 | 4628358939.82344
 JAPAN                     |   1993 | 4634300712.45785
 JAPAN                     |   1992 | 4630917490.94752
 JORDAN                    |   1998 | 2724430478.94559
 JORDAN                    |   1997 | 4658054930.84407
 JORDAN                    |   1996 | 4670236785.79635
 JORDAN                    |   1995 | 4651990009.00455
 JORDAN                    |   1994 | 4659685329.38517
 JORDAN                    |   1993 | 4654365637.24912
 JORDAN                    |   1992 | 4672989967.41988
 KENYA                     |   1998 | 2734921775.02393
 KENYA                     |   1997 | 4645715121.89623
 KENYA                     |   1996 |  4648733767.7528
 KENYA                     |   1995 | 4662134062.65977
 KENYA                     |   1994 | 4628778200.35608
 KENYA                     |   1993 | 4636717062.98464
 KENYA                     |   1992 | 4635761368.80583
 MOROCCO                   |   1998 |  2736929339.7329
 MOROCCO                   |   1997 | 4681018923.45101
 MOROCCO                   |   1996 | 4697516332.62405
 MOROCCO                   |   1995 |  4676792663.2578
 MOROCCO                   |   1994 | 4673407532.00095
 MOROCCO                   |   1993 |  4676030861.1386
 MOROCCO                   |   1992 |  4681483485.7498
 MOZAMBIQUE                |   1998 | 2721924801.49985
 MOZAMBIQUE                |   1997 | 4658898576.86018
 MOZAMBIQUE                |   1996 | 4668871976.98977
 MOZAMBIQUE                |   1995 | 4634993192.63792
 MOZAMBIQUE                |   1994 | 4621225196.95664
 MOZAMBIQUE                |   1993 | 4643033411.81992
 MOZAMBIQUE                |   1992 | 4650163805.44065
 PERU                      |   1998 |  2715697811.5572
 PERU                      |   1997 | 4629637132.61388
 PERU                      |   1996 | 4631022509.05419
 PERU                      |   1995 | 4644906717.62799
 PERU                      |   1994 | 4646572501.13757
 PERU                      |   1993 | 4637817214.35733
 PERU                      |   1992 | 4638034987.25111
 ROMANIA                   |   1998 | 2738848726.74047
 ROMANIA                   |   1997 | 4679997889.94088
 ROMANIA                   |   1996 | 4678115036.85785
 ROMANIA                   |   1995 | 4673090398.76491
 ROMANIA                   |   1994 | 4672726440.73022
 ROMANIA                   |   1993 | 4640181016.14154
 ROMANIA                   |   1992 | 4681816701.89058
 RUSSIA                    |   1998 | 2733294000.12625
 RUSSIA                    |   1997 | 4701114167.59395
 RUSSIA                    |   1996 | 4676892047.23428
 RUSSIA                    |   1995 |  4673963889.8796
 RUSSIA                    |   1994 | 4682332441.62454
 RUSSIA                    |   1993 | 4674472802.92307
 RUSSIA                    |   1992 | 4692254521.02849
 SAUDI ARABIA              |   1998 | 2737248495.76334
 SAUDI ARABIA              |   1997 | 4687644371.70975
 SAUDI ARABIA              |   1996 | 4705213789.70549
 SAUDI ARABIA              |   1995 | 4683755307.46178
 SAUDI ARABIA              |   1994 | 4690010383.79549
 SAUDI ARABIA              |   1993 | 4706701595.96859
 SAUDI ARABIA              |   1992 |  4686223852.8054
 UNITED KINGDOM            |   1998 | 2776786181.73293
 UNITED KINGDOM            |   1997 | 4707499728.09439
 UNITED KINGDOM            |   1996 | 4754620933.87012
 UNITED KINGDOM            |   1995 | 4717450806.31352
 UNITED KINGDOM            |   1994 | 4744177872.42658
 UNITED KINGDOM            |   1993 | 4730117129.51808
 UNITED KINGDOM            |   1992 | 4740532464.90501
 UNITED STATES             |   1998 | 2745911716.11254
 UNITED STATES             |   1997 |  4672636312.1062
 UNITED STATES             |   1996 | 4684203562.59079
 UNITED STATES             |   1995 |  4673547203.5634
 UNITED STATES             |   1994 | 4680423611.92124
 UNITED STATES             |   1993 | 4683279196.21825
 UNITED STATES             |   1992 | 4675236454.34422
 VIETNAM                   |   1998 | 2717252045.68799
 VIETNAM                   |   1997 | 4683087335.17488
 VIETNAM                   |   1996 | 4694371096.47557
 VIETNAM                   |   1995 | 4691773014.99047
 VIETNAM                   |   1994 | 4665069120.25761
 VIETNAM                   |   1993 | 4677246070.68032
 VIETNAM                   |   1992 | 4682300915.94215
(175 rows)

COMMIT;
COMMIT
